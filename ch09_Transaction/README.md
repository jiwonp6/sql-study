# ◎ 데이터베이스 설계

## * 트랜잭션 (Transaction)
  - DBMS에서 데이터를 다루는 논리적 작업 단위
  - 단일 SQL문이거나, 여러개의 SQL문으로 구성
  - 작업 단위는 모두 함께 성공적으로 완료되거나, 아무것도 수행되지 않은 상태가 되어야 함 (All or Nothing)
  - 여러 작업들이 있을 때, 작업 분리 단위, 데이터 복구 작업 단위

  - ex. 은행 계좌간에 금액을 이체하는 상황
    - A계좌에서 B계좌로 10,000원을 전송
      - 작업단위
         1. A계좌에서 10,000원 인출
         2. B계좌에 10,000원 입금
      - 반드시 작업단위 2개가 다 성공적으로 완료되거나
      - 아예 수행이 되지 않아야 함.

### 트랜잭션의 4가지 성질 (ACID)
   1. Atomicity (원자성) : 모든 작업은 하나의 단위로 처리
      - All or Nothing, 쪼개지지 않아야 함
   2. Consistency (일관성) : DB 상태가 작업 전후로 일관성 유지
      - 트랜잭션이 완료된 후 DB의 모든 무결성 제약조건 만족
   3. Isolation (고립성) : 각 트랜잭션은 독립적
      - 각 작업단위는 서로 영향을 주지 않고, 중간 단위를 볼 수 없음
   4. Durability (지속성) : 성공적인 트랜잭션은 영구적으로 유지
      - 시스템 장애가 나더라도 완료된 작업단위는 영구 반영

### TCL (Transaction Control Language)
   - DBMS에서 트랜잭션을 관리하는 SQL문
      1. COMMIT : 트랜잭션 종료. 변경사항 영구적 반영
      2. ROLLBACK : 트랜잭션을 마지막 COMMIT 상태로 복원
      3. SAVEPOINT : 트랜잭션 내 중간지점을 설정 (해당 중간지점까지 ROLLBACK 가능)
   - 트랜잭션의 시작을 알리는 명령어
      - START TRANSACTION
   - 트랜잭션의 끝
      - COMMIT 또는 ROLLBACK => 종료
      - DDL(CREATE, ALTER, DROP ...)문을 만나면 자동으로 종료
   - autocommit
      - SQL문을 실행할 때 자동으로 commit을 수행
      - 활성화 되어있으면 각 SQL문이 별도의 트랜잭션으로 간주
      - 즉시 데이터베이스에 영구적인 변경을 적용
  
### 동시성과 Lock
   - 트랜잭션이 동시에 실행될 때 데이터베이스의 일관성을 해치지 않도록 데이터의 접근을 제어하는 기능
   - 락
      - 트랜잭션이 데이터를 읽거나 변경할 때 데이터에 표시하는 잠금장치
      - 다른 트랜잭션이 접근하지 못하도록 막아 대기 상태로 만듦
   - 락의 종류
     1. 공유 락 (Shared Lock)
      - 여러 트랜잭션이 동시에 데이터를 읽을 수 있도록 허용
      - 공유 락이 걸린 데이터는 다른 트랜잭션도 읽을 수 있지만, 수정 불가
     2. 배타 락 (Exclusive Lock)
      - 락을 건 해당 트랜잭션만 접근과 수정 가능
      - 다른 트랜잭션은 읽기, 수정 불가

### 트랜잭션 고립 수준
   - 여러 트랜잭션이 동시에 DB에 접근할 때 관리 방법을 정의
   - 고립 수준 종류
      1. READ UNCOMMITTED
         - 가장 낮은 수준
         - 커밋되지 않은 변경사항을 다른 트랜잭션이 읽을 수 있음
         - Dirty Read 발생
      2. READ COMMITTED
         - 커밋된 데이터만 읽을 수 있음
         - 다른 트랜잭션에서 데이터를 수정하고 커밋하고 현재 트랜잭션에서 다시 조회하면 다른 데이터가 읽어짐
      3. REPEATABLE READ
         - MySQL의 기본 고립 수준
         - 트랜잭션이 시작되어 종료될 때까지 처음 읽은 데이터의 일관성이 보장
      4. SERIALIZABLE
         - 가장 높은 고립 수준
         - 모든 트랜잭션이 순차적으로 실행되는 것처럼 보장
   - 고립수준에 따라 성능과 데이터 일관성의 trade-off 발생
   - 일반적으로 고립수준이 높을수록 동시성이 감소하고, 성능에 영향을 미침 (높은 일관성)
   - 고립수준이 낮을수록 일관성에 문제가 발생
